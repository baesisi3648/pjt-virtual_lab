# 식품 안전성 평가 AI 플랫폼
## 프로젝트 제안 보고서

> **작성일**: 2026년 2월 24일
> **프로젝트명**: Food Safety Intelligence Platform (FSIP)
> **기반 시스템**: Virtual Lab for NGT Safety Framework (MVP)

---

## 목차

1. [핵심 아이디어](#1-핵심-아이디어)
2. [배경 및 필요성](#2-배경-및-필요성)
3. [현재 진행 내용 (MVP)](#3-현재-진행-내용-mvp)
4. [범용 확장 방향](#4-범용-확장-방향)
5. [Azure OpenAI 연계 고도화](#5-azure-openai-연계-고도화)
6. [사용자 시나리오](#6-사용자-시나리오)
7. [고도화 예상 이슈](#7-고도화-예상-이슈)

---

## 1. 핵심 아이디어

> **AI 멀티에이전트 기반 식품 안전성 평가 플랫폼 — 규제 문서 RAG와 실시간 웹 검색을 결합한 Azure OpenAI 기업형 자동화 솔루션**

---

## 2. 배경 및 필요성

### 2-1. 산업 현황

식품회사는 신제품 출시·원료 변경·수출 시장 진입 등 매 사안마다 복잡한 규제 심사를 수행해야 한다. 현재 이 과정은 **수작업 문헌 검색 → 전문가 검토 → 보고서 작성**의 반복으로 이루어지며, 단일 안전성 검토에 수주~수개월이 소요된다.

| 구분 | 현황 |
|------|------|
| 검토 소요 기간 | 신원료 안전성 검토 평균 3~6개월 |
| 대응 규제 수 | EU, FDA, MFDS, FSANZ, CODEX 등 주요 규제 10개 이상 |
| 연간 업데이트 문서 | 식품 관련 규정 연간 수천 건 개정 |
| 전문인력 부족 | 규제과학 전문가 인력 수급 어려움 |

### 2-2. 핵심 문제

- **정보 파편화**: 관련 규제 문서·가이드라인이 각 규제기관 웹사이트에 분산
- **전문성 병목**: 알레르기, 독성, 영양성, 환경영향 등 다학제 전문지식 동시 필요
- **최신성 유지 비용**: 규정 개정 시 전체 검토 프로세스 재수행
- **문서화 부담**: 동일 구조의 안전성 보고서를 매번 수작업으로 작성

---

## 3. 현재 진행 내용 (MVP)

유전자편집식품(NGT) 안전성 평가 프레임워크 도출을 목표로 MVP를 구현하였다. 아래는 Phase별 구현 내용이다.

### 3-1. 기술 스택

| 레이어 | 기술 |
|--------|------|
| Backend | FastAPI + LangGraph (StateGraph) |
| LLM | OpenAI GPT-4o / GPT-4o-mini (httpx 직접 호출) |
| Vector DB | Pinecone (EU NGT 규정 등 316개 문서 인덱싱) |
| Web Search | Tavily API (실시간 논문·규제 뉴스 검색) |
| Frontend | Next.js 16 + React 19 + Tailwind CSS 4 |
| Streaming | Server-Sent Events (SSE) |

### 3-2. 핵심 구현: LangGraph 3라운드 팀 회의 워크플로우

```
planning → researching → critique → pi_summary → [check_round]
                              ↑                        ↓ (round < 3)
                              └── round_revision ← increment_round
                                                       ↓ (round >= 3)
                                                  final_synthesis → END
```

**PI(연구책임자) 에이전트** — GPT-4o 기반
- 질의 분석 후 필요한 전문가 프로필을 JSON으로 동적 생성
- 라운드별 논의 요약 및 최종 보고서 합성

**Specialist(전문가) 에이전트** — GPT-4o 기반, 병렬 실행
- `ThreadPoolExecutor`로 N명의 전문가가 동시 분석 수행 (5배 속도 향상)
- RAG 검색 + 웹 검색을 병렬로 수행하고 Round 2~3에 캐싱 재사용

**Critic(비평가) 에이전트** — GPT-4o 기반
- 전문가별 분석에 대해 과학적 타당성·논리 일관성·근거 충분성을 1~5점 척도로 평가
- 점수와 구체적 피드백이 다음 라운드 Specialist의 `round_revision`에 직접 반영

### 3-3. Dynamic Agent Factory

```python
# PI가 질의를 분석하여 팀 프로필을 동적 생성
team = decide_team("고올레산 대두 OL-001 EU NGT 안전성 평가")
# → [{"role": "알레르기 전문가", "focus": "..."}, {"role": "독성학자", ...}, ...]

# 프로필로부터 System Prompt를 자동 생성하고 GPT-4o 에이전트를 반환
agent = create_specialist(profile)
```

### 3-4. 프론트엔드

- SSE로 에이전트 진행 상황을 실시간 스트리밍 (planning → researching → critique → ...)
- 최종 보고서 마크다운 에디터 (수정·저장·복사)
- 캐릭터 시각화 패널 (각 에이전트의 진행 상태 시각화)

---

## 4. 범용 확장 방향

NGT에 특화된 MVP를 **식품회사 전반의 규제 대응 플랫폼**으로 확장한다. 핵심 멀티에이전트 아키텍처는 그대로 유지하되, **도메인·규제·문서 레이어를 범용화**한다.

### 4-1. 확장 도메인

| 평가 유형 | 주요 질의 예시 | 구성되는 전문가 팀 |
|-----------|----------------|-------------------|
| **신원료 안전성** | 새로운 기능성 원료 A의 식약처 인정 요건 검토 | 독성학자, 임상영양사, 규제과학 전문가 |
| **식품첨가물 검토** | 보존료 B를 국내 기준 초과 함량 사용 가능 여부 | 식품화학자, 독성학자, 법규 전문가 |
| **알레르겐 관리** | 원재료 C 변경 시 알레르겐 교차오염 위험 평가 | 알레르기 전문가, 품질관리 전문가 |
| **수출 규제 적합성** | 제품 D의 EU·미국·일본 동시 수출 규제 적합성 | EU 규제 전문가, FDA 전문가, 일본 후생성 전문가 |
| **라벨링 적합성** | 기능성 표시 E에 대한 국내외 광고·표시 적합성 | 법규 전문가, 임상영양사, 마케팅 컴플라이언스 |
| **HACCP 문서화** | 공정 F의 위해요소 분석 및 CCP 설정 | HACCP 전문가, 미생물학자, 공정 엔지니어 |
| **건강기능식품 심사** | 기능성 원료 G의 고시형 원료 전환 가능성 검토 | 임상영양사, 독성학자, 규제과학 전문가 |
| **NGT/GMO 안전성** | 유전자편집 원료 H의 국내외 심사 기준 비교 | 분자생물학자, 독성학자, NGT 규제 전문가 |

### 4-2. 범용화 아키텍처 변경점

**현재 (NGT 특화)**
```
RAG: NGT 규제 문서 316개 (Pinecone 단일 인덱스)
Prompt: NGT 안전성 평가 프레임워크에 특화된 System Prompt
보고서: 4파트 고정 구조 (위험 식별, 지침 평가, 업데이트, 결론)
```

**확장 후 (범용 식품 안전)**
```
RAG: 도메인별 멀티 인덱스
  - index: food-additives    (식품첨가물 기준·규격)
  - index: allergen-mgmt     (알레르겐 관리 지침)
  - index: export-regulations (국가별 수출 규제)
  - index: ngt-gmo           (유전자편집·GMO 규정)
  - index: haccp             (HACCP 관련 문서)
  - index: company-sop       (기업 자체 SOP·과거 심사 결과)

Prompt: 질의 유형 자동 감지 → 도메인에 맞는 PI 지시 템플릿 선택
보고서: 평가 유형별 동적 보고서 구조 생성
```

### 4-3. 기업 내부 지식 통합 (핵심 차별화)

식품회사의 **내부 SOP, 과거 규제 심사 결과, 배합비 히스토리**를 Pinecone 인덱스에 추가하여 RAG 검색 범위에 포함한다. 이를 통해:

- "우리 회사가 과거에 유사 원료로 심사받은 결과는?" → 내부 문서에서 RAG 검색
- "현행 SOP 대비 이번 공정 변경의 HACCP 영향은?" → 내부 SOP + 외부 가이드라인 결합 분석
- 기업 고유의 규제 대응 노하우가 플랫폼에 누적됨

---

## 5. Azure OpenAI 연계 고도화

### 5-1. Azure OpenAI Service 전환 (핵심)

현재 `utils/llm.py`는 `httpx`로 OpenAI API를 직접 호출하므로, **엔드포인트 URL과 인증 헤더만 교체**하면 Azure OpenAI로 전환 가능하다. 기존 `call_gpt4o()` / `call_gpt4o_mini()` 인터페이스는 그대로 유지된다.

```python
# 현재
OPENAI_API_URL = "https://api.openai.com/v1/chat/completions"
headers = {"Authorization": f"Bearer {api_key}"}

# Azure 전환 후
AZURE_ENDPOINT = "https://{resource}.openai.azure.com/openai/deployments/{deployment}/chat/completions?api-version=2024-02-01"
headers = {"api-key": azure_api_key}
```

**Azure 전환 효과**:
- 기업 데이터가 Azure 테넌트 내에서만 처리 → 식품 배합비·내부 심사 자료 보안 확보
- 한국·일본 리전 선택 가능 → 개인정보보호법·데이터 레지던시 준수
- 엔터프라이즈 SLA (99.9% 가용성)

### 5-2. Azure AI Search로 RAG 고도화

현재 Pinecone 단일 인덱스를 **Azure AI Search 멀티 인덱스**로 전환한다.

| 항목 | 현재 (Pinecone) | Azure AI Search |
|------|-----------------|-----------------|
| 검색 방식 | 벡터 유사도만 | 벡터 + 키워드 하이브리드 |
| 인덱스 수 | 1개 | 도메인별 N개 |
| 신규 문서 반영 | 수동 스크립트 | Blob Storage 이벤트 트리거 자동화 |
| 기업 내부 문서 보안 | 외부 SaaS | Azure 테넌트 내 완전 격리 |
| 임베딩 | text-embedding-ada-002 | text-embedding-3-large (Azure) |

### 5-3. Azure Blob Storage + 문서 인덱싱 파이프라인

```
[신규 규제 문서 업로드]
        ↓
Azure Blob Storage
        ↓ (Event Trigger)
Azure Functions
        ↓
PDF 파싱 + 청킹 + 임베딩
        ↓
Azure AI Search 인덱스 자동 업데이트
        ↓
[다음 RAG 검색에 즉시 반영]
```

- 식약처 고시 개정, EU 규정 업데이트 → 파일 업로드만으로 RAG 지식 자동 갱신
- 현재 `scripts/load_pdfs_to_pinecone.py`의 수동 프로세스를 완전 자동화

### 5-4. Azure Monitor + Application Insights

LangGraph 각 노드의 처리 시간·토큰 사용량·오류율을 Azure Monitor로 수집한다.

```
planning  → 평균 소요시간 / 토큰 수
researching (병렬 N명) → 전문가별 소요시간
critique  → 전문가별 점수 추이
final_synthesis → 최종 보고서 품질 지표
```

- 도메인별 비용 추적 (수출 규제 검토 vs HACCP 문서화 비교)
- 이상 패턴 감지 시 PagerDuty 연동 알림

### 5-5. Azure Content Safety 레이어

`final_synthesis` 출력에 Content Safety API를 적용하여 보고서의 근거 없는 주장, 규제 오정보를 자동 플래그 처리한다. 식품 규제 도메인의 전문 용어(독성 수치, 알레르겐 등)가 일반 필터에 오탐되지 않도록 Custom Blocklist를 설정한다.

### 5-6. Azure API Management

FastAPI 백엔드를 Azure API Management로 래핑하여 기업 내 부서별 사용량 제어, OAuth 2.0 인증, API 버전 관리를 제공한다. 외부 협력사·CMO에 안전한 API 접근 권한을 부여하는 B2B 확장이 가능해진다.

---

## 6. 사용자 시나리오

### 시나리오 A — 신원료 안전성 검토 (R&D팀)

**사용자**: 대형 식품사 R&D 연구원
**상황**: 해외에서 도입한 신규 기능성 원료 "콜라겐 펩타이드 X"의 국내 건강기능식품 원료 등록 가능성 검토

1. **질의 입력**: "콜라겐 펩타이드 X의 식약처 건강기능식품 고시형 원료 등록 요건 및 기존 유사 인정 사례를 검토해줘"
2. **자동 팀 구성**: PI가 임상영양사, 독성학자, 규제과학 전문가 3인 팀 구성
3. **3라운드 분석**:
   - Round 1: 각 전문가가 RAG(식약처 고시, 기능성 원료 DB)·웹 검색(해외 임상 논문)으로 독립 분석
   - Round 2: Critic 피드백(임상 근거 불충분, 흡수율 데이터 누락) 반영하여 심화 분석
   - Round 3: 최종 수렴 → 등록 요건 충족 여부, 필요 추가 시험 목록, 예상 심사 기간 포함 보고서 생성
4. **결과 활용**: 보고서를 식약처 사전 상담 자료로 활용

**기대 효과**: 기존 3개월 → 2~3일로 초기 검토 기간 단축

---

### 시나리오 B — 수출 규제 적합성 검토 (수출영업팀)

**사용자**: 중견 식품사 해외영업 담당자
**상황**: 인기 김치 제품을 EU·미국·일본 3개국 동시 수출 시 각국 규제 적합성 확인 필요

1. **질의 입력**: "김치 제품(주성분: 배추, 고춧가루, 마늘, 젓갈)의 EU/미국/일본 수출 시 식품첨가물·알레르겐·라벨링 규정 적합성을 국가별로 검토해줘"
2. **자동 팀 구성**: PI가 EU 식품법 전문가, FDA 전문가, 일본 후생성 전문가, 알레르겐 전문가 4인 구성
3. **병렬 분석**: 4명의 전문가가 동시에 각국 규제 데이터베이스 검색 (ThreadPoolExecutor)
4. **최종 보고서**: 국가별 규제 적합 여부 표, 조치 필요 항목(알레르겐 표시 추가, 첨가물 함량 조정 등), 수정 후 재검토 제안
5. **Azure 내부 문서 연동**: 과거 유사 제품 수출 심사 결과(사내 SOP)를 RAG로 검색하여 대응 사례 참고

**기대 효과**: 국가별 전문 컨설턴트 비용 절감, 수출 준비 기간 단축

---

### 시나리오 C — HACCP 위해요소 분석 자동화 (품질관리팀)

**사용자**: 제조 식품사 품질관리 담당자
**상황**: 신규 제조 라인 도입에 따른 HACCP 계획서 갱신 필요

1. **질의 입력**: "레토르트 즉석식품 공정에 신규 충전 공정이 추가됐을 때, HACCP 위해요소 분석 및 CCP 설정 방법을 도출해줘"
2. **자동 팀 구성**: HACCP 전문가, 미생물학자, 공정 엔지니어, 포장재 안전 전문가 구성
3. **3라운드 분석**: 생물학적·화학적·물리적 위해요소 식별 → Critic 검증 → CCP 결정 트리 적용
4. **최종 산출물**: HACCP 계획서 초안 (위해요소 목록, CCP 위치, 한계기준, 모니터링 방법, 시정조치 포함)
5. **문서 에디터**: 프론트엔드에서 담당자가 내용 수정 후 공식 HACCP 문서로 저장

**기대 효과**: HACCP 컨설팅 외주 비용 절감, 내부 품질 역량 강화

---

### 시나리오 D — 원재료 변경 시 알레르겐 위험 평가 (구매팀)

**사용자**: 원자재 구매팀
**상황**: 원가 절감을 위해 참깨유를 해바라기씨유로 변경 검토 중

1. **질의 입력**: "참깨유를 해바라기씨유로 대체할 때 알레르겐 교차오염 위험성과 라벨 변경 요건을 검토해줘"
2. **자동 팀 구성**: 알레르기 전문가, 식품법규 전문가, 품질관리 전문가 구성
3. **분석 내용**: 참깨 알레르겐(Ses i 1~7) 교차반응 가능성, 공유 설비 세척 검증 기준, 각국 알레르겐 표시 의무
4. **최종 보고서**: 대체 가능 여부 판정, 필요 조치(교차오염 시험, 라벨 변경, 소비자 안내 등) 목록

---

## 7. 고도화 예상 이슈

### 7-1. 기술적 이슈

| 이슈 | 원인 | 대응 방향 |
|------|------|----------|
| **Azure OpenAI 모델 버전 관리** | Azure 배포명(deployment name)과 모델 버전 불일치, 리전별 가용성 차이 | 환경변수로 deployment명 분리, 리전 폴백 로직 구현 (`AZURE_DEPLOYMENT_4O`, `AZURE_DEPLOYMENT_MINI`) |
| **멀티 인덱스 RAG 라우팅** | 질의가 복수의 도메인에 걸칠 때 어느 인덱스를 검색할지 판단 어려움 | PI 에이전트가 질의 분석 시 관련 인덱스 목록도 함께 결정하는 메타-라우팅 로직 추가 |
| **토큰 비용 폭증** | 3라운드 × 병렬 N명 × 장문 컨텍스트 → 단일 평가당 수십만 토큰 | Round 1·2는 GPT-4o-mini, Round 3만 GPT-4o 투입하는 계층화 전략; 요약 압축 단계 추가 |
| **검색 결과 최신성** | 규정 개정 사실이 웹 검색보다 RAG 내부 문서에 먼저 반영될 수 있음 | Azure Blob 이벤트 트리거로 신규 고시 자동 인덱싱; 검색 결과에 문서 작성 날짜 메타데이터 표시 |
| **병렬 에이전트 상태 일관성** | ThreadPoolExecutor 사용 시 LangGraph StateGraph의 불변성 원칙 충돌 가능성 | 로컬 변수로 결과 수집 후 StateGraph 업데이트; 현재 MVP에서 검증 완료된 패턴 유지 |
| **LangGraph 서버리스 배포** | Azure Functions(서버리스) 환경에서 StateGraph 객체 직렬화 불가 | Azure Container Apps 또는 Azure Kubernetes Service(AKS)로 배포; Durable Functions로 상태 외부화 |

### 7-2. 비즈니스·운영 이슈

| 이슈 | 내용 | 대응 방향 |
|------|------|----------|
| **보고서 법적 책임** | AI가 생성한 안전성 보고서가 규제 제출에 사용될 경우 법적 책임 소재 불명확 | 보고서에 "AI 보조 작성, 전문가 검토 필수" 워터마크 삽입; 최종 보고서에 담당자 서명란 의무화 |
| **내부 기밀 문서 RAG 보안** | 배합비·심사 자료를 RAG에 추가 시 정보 유출 우려 | Azure AI Search의 문서별 ACL(접근제어) 설정; 부서·사용자 권한에 따른 검색 범위 제한 |
| **규제 오정보 위험** | LLM이 최신 개정 사항을 반영하지 못하거나 부정확한 규제 해석 생성 가능 | Critic 에이전트에 "규제 최신성 검증" 역할 추가; 규정 조문 인용 시 원문 URL 필수 포함 |
| **다국어 규제 문서 처리** | EU 관보(EU Official Journal)는 독일어·프랑스어 원문이 법적 효력, 번역 오류 위험 | 핵심 규제 조문은 원문 + 한국어 번역을 병렬 청킹하여 인덱싱; 원문 URL 인용 의무화 |
| **사용자 프롬프트 품질 편차** | 전문 지식이 없는 사용자의 모호한 질의 → 엉뚱한 전문가 팀 구성 | 질의 입력 단계에서 도메인 선택 UI 제공 (신원료/수출/HACCP 등); 예시 질의 템플릿 제공 |
| **Content Safety 과검열** | 독성 수치, 알레르겐 성분명 등 전문 용어가 일반 Content Safety 필터에 오탐 | Azure Content Safety Custom Blocklist로 식품·의학 도메인 예외 규칙 정의 |

### 7-3. 확장성 이슈

| 이슈 | 내용 | 대응 방향 |
|------|------|----------|
| **멀티테넌시** | 복수의 식품회사가 동일 플랫폼 사용 시 기업별 RAG 인덱스 격리 필요 | Pinecone/Azure AI Search에서 namespace 또는 별도 인덱스로 테넌트 분리 |
| **문서 최신성 SLA** | "이 보고서는 X일 기준 규정을 반영합니다" 약속이 깨질 경우 신뢰도 하락 | 인덱스별 마지막 업데이트 시각을 보고서 헤더에 자동 표기 |
| **산업 표준 연동** | CODEX, ISO 22000, FSSC 22000 등 국제 표준 문서 지속 추가 필요 | 표준기관 RSS·API 연동으로 신규 발행 문서 자동 수집 파이프라인 구축 |

---

*본 보고서는 현재 MVP(Virtual Lab for NGT Safety Framework) 기반으로 작성되었으며, 위 고도화 방향은 Azure OpenAI Service와의 연계를 전제로 합니다.*
